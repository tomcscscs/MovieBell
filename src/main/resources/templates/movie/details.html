<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>무비 상세페이지</title>
<link rel="stylesheet" type="text/css" th:href="@{/css/style.css}">

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
	crossorigin="anonymous">

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
	rel="stylesheet">



<style>
.blur {
	filter: blur(6px);
}

@import
	url('https://fonts.googleapis.com/css2?family=Hahmlet:wght@100..900&family=Lora:ital,wght@0,400..700;1,400..700&display=swap')
	;
</style>
<style>
@import
	url('https://fonts.googleapis.com/css2?family=Mochiy+Pop+P+One&display=swap')
	;

h1 {
	font-family: "Mochiy Pop P One", sans-serif;
	font-weight: 400;
	font-style: normal;
}
</style>

</head>
<body>

	<nav th:replace="~{fragment/template::navbar}"></nav>

	<div style="position: relative;" id="content"
		th:data-movie-id="${details.id}"
		th:data-movie-title="${details.originalTitle}"
		th:data-poster-path="${details.posterPath}"
		th:data-release-date="${details.releaseDate}">
		<img
			th:src="@{https://image.tmdb.org/t/p/original{path}(path=${details.backdropPath})}"
			alt="Background Image" style="width: 100%; height: auto;"
			class="blur"> <img
			th:src="@{https://image.tmdb.org/t/p/w500{path}(path=${details.posterPath})}"
			alt="Poster Image" style="position: absolute; top: 0; left: 0;">



		<div class="container top-2">
			<div
				class="additional-info text-white position-absolute top-50 end-0 p-3 w-25 start-50 translate-middle">
				<div class="text-white lora-movietitle"
					style="text-align: left; font-size: 50px; width: 50rem"
					th:text="${details.originalTitle}"></div>
				<div class="card" style="width: 50rem; opacity: 0.5;">
					<!-- 배경에만 투명도 적용 -->
					<div class="card-body">
						<h6 class="card-subtitle mb-2 text-body-secondary test-red">Card
							subtitle</h6>
						<p class="card-text" th:text="${details.overview}"></p>
						<div class="d-flex my-2 align-items-center">
							<div class="p-2 border-end  d-flex justify-content-between">
								<div class="p-2 border-end">
									<i th:if="${picked}" class="bi bi-heart-fill" id="pick"
										style="cursor: pointer; font-size: 3rem;"></i> <i
										th:unless="${picked}" class="bi bi-heart" id="pick"
										data-picked="${picked}"
										style="cursor: pointer; font-size: 3rem"></i>
								</div>
								<i class="bi bi-card-text ms-3"
									style="cursor: pointer; font-size: 3rem"
									th:onclick="location.href='/community/main'"></i>
							</div>
							<div class="p-2">
								<button class="btn btn-sm btn-dark" type="button"
									onclick="location.href='${contextPath}/chat/link?productId=${product.id }'">###</button>
							</div>
						</div>

					</div>
				</div>
			</div>
		</div>

	</div>



	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
		crossorigin="anonymous"> </script>

	<script>
	document.addEventListener("DOMContentLoaded", function() {
	    const heartIcon = document.getElementById("pick");
	    let picked = heartIcon.dataset.picked === "true";	
	    const content= document.querySelector("#content");
	    heartIcon.addEventListener("click", function() {
	        // 서버로 전송할 데이터 설정
	        const formData = new FormData();
	        formData.append("picked", !picked);
	        formData.append("movieId", content.dataset.movieId);
	        formData.append("movieTitle", content.dataset.movieTitle);
	        formData.append("releaseDate", content.dataset.releaseDate);
	        formData.append("posterPath", content.dataset.posterPath);
	        
	        fetch("/ajax/pickAjax",{
	        	method: "POST",
	        	body: formData
	        })
	        .then(response => response.json())
	        .then(data => {
	        	if(data.result == "success"){
	        		
	        		picked= !picked;
	        		
	        		if(picked){
	        			heartIcon.classList.remove("bi-heart");
	        			heartIcon.classList.add("bi-heart-fill");
	        			
	        		}else{
	        			heartIcon.classList.add("bi-heart-fill");
	        			heartIcon.classList.remove("bi-heart");
	        			
	        		}
	        	}else{
	        		console.error("Error가 났네요. 코드를 확인하세요.")
	        	}
	        	
	        	})
	        	.catch(error => {
	        		console.error("Error", error);
	        	});
	        	});
	        	});
	        
	    
	    
	        	
	        
	        
	        

	
	
	
	</script>



</body>
</html>











